<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bad Movies Squad</title>

    <!-- update the version number as needed -->
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-functions.js"></script>
    <script defer src="/__/firebase/init.js"></script>
    <!-- load custom scripts and stylesheets -->
    <link rel="stylesheet" href="/css/app.css">
    <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>

  </head>
  <body>

    <h1>Bad Movie Squad STATZ</h1>

    <div id="app">
      <router-link to="/login">Login</router-link>
      <br>
      <router-link to="/dashboard">Dashboard</router-link>

      <router-view></router-view>
    </div>


    <script type="text/javascript" src="/js/app.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
      // Move to routes file after we get importing
      Vue.use(VueRouter)


      const Login = Vue.extend({
          template: '<div>LOGIN</div>',
          mounted() {
              console.log('Login Component: Mounted')
              var provider = new firebase.auth.GoogleAuthProvider()
              window.firebase.auth().signInWithPopup(provider).then(function(result) {
                  // This gives you a Google Access Token. You can use it to access the Google API.
                  var token = result.credential.accessToken;
                  // The signed-in user info.
                  var user = result.user;

                  console.log('tok', token, 'user', user);
                  // ...
                }).catch(function(error) {
                  // Handle Errors here.
                  var errorCode = error.code;
                  var errorMessage = error.message;
                  // The email of the user's account used.
                  var email = error.email;
                  // The firebase.auth.AuthCredential type that was used.
                  var credential = error.credential;
                  // ...
                });

                firebase.auth().onAuthStateChanged(user => {
                  if (user) {
                    console.log('User Authenticated', user);
                    console.log('Changing to dashboard Route');
                    router.push('dashboard');
                  } else {
                    console.log('User Not Authendticated')
                  }
                });
          },
          updated() {
              console.log('Login Component: Updated')
          }
      })

      const Dashboard = Vue.extend({
          template: '<div>DASH</div>',
          mounted() {
              console.log('Dashboard Component: Mounted')
          },
          updated() {
              console.log('Dashboard Component: Updated')
          }
      })

      const routes = [
          { name: 'login', path: '/login', component: Login },
          { name: 'dashboard', path: '/dashboard', component: Dashboard }
      ]

      const router = new VueRouter({
          routes
      })

      const app = new Vue({
          router,
      }).$mount('#app');

      });
    </script>
  </body>
</html>
